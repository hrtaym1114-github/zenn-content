# Playwright CLI vs MCP トークン消費量 実測サマリー

## 計測環境

- Claude Code: v2.1.58
- Plan: Claude Max
- Model: claude-opus-4-6
- OS: macOS Darwin 25.3.0
- @playwright/cli: v1.59.0-alpha-1771104257000
- @playwright/mcp: latest (stdio via npx)
- 計測方法: デバッグログ内の `claude_code.token.usage` メトリクス（OTel console exporter）
- 計測日: 2026-02-26
- ツール制限: CLI試行は `--disallowedTools "mcp__playwright__*"`, MCP試行は `--disallowedTools "Bash"`

## 結果一覧

### Simple: ページ読み取り

| 試行 | 手法 | Input | Output | Cache read | Cache creation | Total | ツール回数 | 時間(秒) |
|------|------|------:|-------:|-----------:|---------------:|------:|----------:|---------:|
| 1 | CLI | 75,960 | 122,417 | 2,428,036 | 293,406 | 198,377 | 13 | 152 |
| 2 | CLI | 72,102 | 38,903 | 1,561,862 | 207,547 | 111,005 | 6 | 101 |
| 3 | CLI | 52,024 | 35,339 | 1,479,161 | 137,578 | 87,363 | 8 | 99 |
| 1 | MCP | 10,711 | 5,097 | 411,956 | 51,424 | 15,808 | 4 | 55 |
| 2 | MCP | 14,130 | 5,698 | 401,885 | 134,515 | 19,828 | 4 | 59 |
| 3 | MCP | 6,188 | 3,547 | 236,437 | 40,920 | 9,735 | 3 | 44 |

### Medium: フォーム入力

| 試行 | 手法 | Input | Output | Cache read | Cache creation | Total | ツール回数 | 時間(秒) |
|------|------|------:|-------:|-----------:|---------------:|------:|----------:|---------:|
| 1 | CLI | 18,884 | 10,035 | 529,122 | 59,215 | 28,919 | 5 | 59 |
| 2 | CLI | 51,654 | 19,099 | 1,085,707 | 95,204 | 70,753 | 5 | 81 |
| 3 | CLI | 47,001 | 30,028 | 1,724,402 | 119,959 | 77,029 | 11 | 89 |
| 1 | MCP | 6,420 | 9,655 | 926,861 | 98,429 | 16,075 | 8 | 68 |
| 2 | MCP | 348,971 | 81,605 | 5,493,719 | 633,292 | 430,576 | 4 | 406 |
| 3 | MCP | 22,631 | 8,076 | 572,954 | 79,760 | 30,707 | 4 | 64 |

### Complex: マルチステップ

| 試行 | 手法 | Input | Output | Cache read | Cache creation | Total | ツール回数 | 時間(秒) |
|------|------|------:|-------:|-----------:|---------------:|------:|----------:|---------:|
| 1 | CLI | 86,977 | 43,645 | 1,958,676 | 162,989 | 130,622 | 16 | 108 |
| 2 | CLI | 63,511 | 36,043 | 1,714,130 | 148,319 | 99,554 | 10 | 101 |
| 3 | CLI | 40,943 | 28,210 | 2,016,574 | 139,928 | 69,153 | 11 | 116 |
| 1 | MCP | 8,646 | 18,780 | 1,620,257 | 141,803 | 27,426 | 12 | 84 |
| 2 | MCP | 119 | 13,631 | 1,145,021 | 121,655 | 13,750 | 10 | 73 |
| 3 | MCP | 121 | 16,061 | 901,350 | 431,153 | 16,182 | 9 | 81 |

## 集計（中央値）

| シナリオ | 指標 | CLI | MCP | 比率 (MCP/CLI) |
|----------|------|----:|----:|:--------------:|
| Simple | Total tokens | 111,005 | 15,808 | 0.14x |
| Simple | ツール回数 | 8 | 4 | 0.50x |
| Simple | 時間(秒) | 101 | 55 | 0.54x |
| Medium | Total tokens | 70,753 | 30,707 | 0.43x |
| Medium | ツール回数 | 5 | 4 | 0.80x |
| Medium | 時間(秒) | 81 | 68 | 0.84x |
| Complex | Total tokens | 99,554 | 16,182 | 0.16x |
| Complex | ツール回数 | 11 | 10 | 0.91x |
| Complex | 時間(秒) | 108 | 81 | 0.75x |

## 全体中央値

| 指標 | CLI | MCP | 比率 |
|------|----:|----:|:----:|
| Total tokens | 87,363 | 16,182 | **0.185x** |
| ツール回数 | 10 | 4 | 0.40x |
| 時間(秒) | 101 | 68 | 0.67x |

## エラー発生状況

| 指標 | CLI | MCP |
|------|:---:|:---:|
| エラー発生試行 | 6/9 (67%) | 0/9 (0%) |
| 総エラー回数 | 8回 | 0回 |

CLI は Bash tool error (Shell command failed) が頻発。特に Simple シナリオで多い（trial1 で3回）。
npx 経由の playwright-cli 起動でソケット競合やコマンド解決エラーが発生し、リトライによるトークン・時間の追加消費が発生。

## 考察

外部ベンチマークでは「CLIがMCPより4倍効率的」とされているが、Claude Code環境での実測では**MCPの方が5〜7倍効率的**という逆の結果となった。

主な要因:
1. **CLIの不安定性**: npx経由のplaywright-cli起動がエラーを頻発し、リトライでトークンが膨張
2. **Bashツールのオーバーヘッド**: コマンド出力がそのままコンテキストに入り、MCPのコンパクトなレスポンスより嵩張る
3. **Claude CodeのMCP統合の成熟度**: MCPツールは直接統合されており、プロセス起動コストがない

## 注意事項

- mcp-medium-trial2 は外れ値（430k tokens, 406秒）。中央値で吸収済み
- mcp-complex の input tokens が極端に低い試行あり（119, 121）
- 全18試行で100%タスク成功
