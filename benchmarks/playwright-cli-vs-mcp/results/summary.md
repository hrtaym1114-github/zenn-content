# Playwright CLI vs MCP トークン消費量 実測サマリー

## 計測環境

- Claude Code: v2.1.58
- Plan: Claude Max
- Model: claude-opus-4-6
- OS: macOS Darwin 25.3.0
- @playwright/cli: v1.59.0-alpha-1771104257000（グローバルインストール）
- @playwright/mcp: latest (stdio via npx)
- スキル: `.claude/skills/playwright-cli/` インストール済み
- 計測方法: デバッグログ内の `claude_code.token.usage` メトリクス（OTel console exporter）
- 計測日: 2026-02-26〜27
- ツール制限: CLI試行は `--disallowedTools "mcp__playwright__*"`, MCP試行は `--disallowedTools "Bash"`

## 結果一覧

### Simple: ページ読み取り

| 試行 | 手法 | Input | Output | Cache read | Cache creation | Total | ツール回数 | 時間(秒) |
|------|------|------:|-------:|-----------:|---------------:|------:|----------:|---------:|
| 1 | CLI | 8,946 | 6,545 | 725,639 | 122,459 | 15,491 | 5 | 53 |
| 2 | CLI | 7,839 | 8,024 | 1,070,788 | 68,815 | 15,863 | 6 | 54 |
| 3 | CLI | 13,004 | 11,960 | 1,490,616 | 94,678 | 24,964 | 5 | 69 |
| 1 | MCP | 10,711 | 5,097 | 411,956 | 51,424 | 15,808 | 4 | 55 |
| 2 | MCP | 14,130 | 5,698 | 401,885 | 134,515 | 19,828 | 4 | 59 |
| 3 | MCP | 6,188 | 3,547 | 236,437 | 40,920 | 9,735 | 3 | 44 |

### Medium: フォーム入力

| 試行 | 手法 | Input | Output | Cache read | Cache creation | Total | ツール回数 | 時間(秒) |
|------|------|------:|-------:|-----------:|---------------:|------:|----------:|---------:|
| 1 | CLI | 36,427 | 24,381 | 3,142,546 | 619,341 | 60,808 | 10 | 96 |
| 2 | CLI | 27,963 | 18,936 | 2,697,086 | 122,939 | 46,899 | 12 | 77 |
| 3 | CLI | 122,651 | 66,638 | 11,618,507 | 363,268 | 189,289 | 13 | 191 |
| 1 | MCP | 6,420 | 9,655 | 926,861 | 98,429 | 16,075 | 8 | 68 |
| 2 | MCP | 348,971 | 81,605 | 5,493,719 | 633,292 | 430,576 | 4 | 406 |
| 3 | MCP | 22,631 | 8,076 | 572,954 | 79,760 | 30,707 | 4 | 64 |

### Complex: マルチステップ

| 試行 | 手法 | Input | Output | Cache read | Cache creation | Total | ツール回数 | 時間(秒) |
|------|------|------:|-------:|-----------:|---------------:|------:|----------:|---------:|
| 1 | CLI | 1,514,724 | 881,330 | 154,583,744 | 3,959,642 | 2,396,054 | 20 | 1,296 |
| 2 | CLI | 125,301 | 76,382 | 12,150,681 | 385,530 | 201,683 | 20 | 163 |
| 3 | CLI | 125,199 | 75,544 | 12,014,391 | 377,804 | 200,743 | 20 | 155 |
| 1 | MCP | 8,646 | 18,780 | 1,620,257 | 141,803 | 27,426 | 12 | 84 |
| 2 | MCP | 119 | 13,631 | 1,145,021 | 121,655 | 13,750 | 10 | 73 |
| 3 | MCP | 121 | 16,061 | 901,350 | 431,153 | 16,182 | 9 | 81 |

## 集計（中央値）

| シナリオ | 指標 | CLI | MCP | 比率 (MCP/CLI) |
|----------|------|----:|----:|:--------------:|
| Simple | Total tokens | 15,863 | 15,808 | 1.00x |
| Simple | ツール回数 | 5 | 4 | 0.80x |
| Simple | 時間(秒) | 54 | 55 | 1.02x |
| Medium | Total tokens | 60,808 | 30,707 | 0.50x |
| Medium | ツール回数 | 12 | 4 | 0.33x |
| Medium | 時間(秒) | 96 | 68 | 0.71x |
| Complex | Total tokens | 201,683 | 16,182 | 0.08x |
| Complex | ツール回数 | 20 | 10 | 0.50x |
| Complex | 時間(秒) | 163 | 81 | 0.50x |

## 全体中央値

| 指標 | CLI | MCP | 比率 |
|------|----:|----:|:----:|
| Total tokens | 60,808 | 16,182 | **0.27x** |
| ツール回数 | 12 | 4 | 0.33x |
| 時間(秒) | 96 | 73 | 0.76x |

## エラー発生状況

| 指標 | CLI (旧: npx) | CLI (新: global+skills) | MCP |
|------|:-------------:|:-----------------------:|:---:|
| エラー発生試行 | 6/9 (67%) | 0/9 (0%) | 0/9 (0%) |
| 総エラー回数 | 8回 | 0回 | 0回 |

## 旧CLI → 新CLI 改善比較

| シナリオ | 旧CLI中央値 | 新CLI中央値 | 改善率 |
|----------|----------:|----------:|:------:|
| Simple | 111,005 | 15,863 | **-86% (7倍改善)** |
| Medium | 70,753 | 60,808 | -14% |
| Complex | 99,554 | 201,683 | +103% (悪化※) |

※ Complex の悪化は、エラーリトライがなくなった代わりにツール呼び出し回数が20回に増加（旧11回）し、各コマンド出力の累積でコンテキストが膨張したため。cli-complex-trial1 は外れ値（2.4M tokens, 1,296秒）。

## 考察

### 1. セットアップの影響は甚大

グローバルインストール + スキルにより、Simple シナリオで **7倍の改善** が得られた。npx 経由の起動エラーが完全消滅し、CLI の本来の性能が発揮された。

### 2. Simple は CLI ≈ MCP（ほぼ同等）

正しくセットアップされた CLI は、Simple タスクで MCP とほぼ同じトークン効率（15.8k vs 15.8k）。単純な操作では CLI の「ファイルに保存→必要時に読む」アーキテクチャの恩恵が出にくく、両者の差は生まれない。

### 3. 操作が複雑になるほど MCP が有利

- Medium: MCP は CLI の半分のトークン（0.50x）
- Complex: MCP は CLI の 1/12 のトークン（0.08x）

CLI は操作ステップごとに Bash ツール呼び出しが必要で、各コマンドの stdout 出力（ページ状態、スナップショットパス等）がコンテキストに蓄積される。MCP はツール呼び出しのレスポンスがよりコンパクトで、長いセッションほど差が開く。

### 4. 外部ベンチマークとの乖離

外部ベンチマーク（CLI が MCP より4倍効率的）と逆の結果が出た理由:
- 外部ベンチマークは **ツールスキーマの初期コスト** を重視（MCPの26ツール vs CLIの1コマンド）
- Claude Code環境では **多数のMCPサーバーが接続** されており、Playwright MCP のスキーマコストは相対的に小さい
- Claude Code の **Bash ツール呼び出しのオーバーヘッド**（pre/post hooks等）が外部ベンチマークでは考慮されていない

### 5. 注意事項

- mcp-medium-trial2（430k tokens, 406秒）と cli-complex-trial1（2.4M tokens, 1,296秒）は外れ値。中央値で吸収済み
- mcp-complex の input tokens が極端に低い試行あり（119, 121）
- 全18試行で100%タスク成功
